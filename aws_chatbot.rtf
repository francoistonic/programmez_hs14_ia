{\rtf1\ansi\ansicpg1252\cocoartf2761
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 Menlo-Regular;\f1\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;
\red15\green112\blue1;\red144\green1\blue18;\red19\green118\blue70;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c100000;\cssrgb\c100000\c100000\c100000;\cssrgb\c0\c0\c0;
\cssrgb\c0\c50196\c0;\cssrgb\c63922\c8235\c8235;\cssrgb\c3529\c52549\c34510;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
import\cf0  boto3
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Sp\'e9cifier le service utilis\'e9.
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
dynamodb = boto3.resource(\cf6 "dynamodb"\cf0 )
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Cr\'e9ation de la table nomm\'e9e "SessionTable" avec l'attribut "SessionId".
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
table = dynamodb.create_table(
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 TableName=\cf6 "SessionTable"\cf0 ,
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 KeySchema=[\{\cf6 "AttributeName"\cf0 : \cf6 "SessionId"\cf0 , \cf6 "KeyType"\cf0 : \cf6 "HASH"\cf0 \}],
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 AttributeDefinitions=[\{\cf6 "AttributeName"\cf0 : \cf6 "SessionId"\cf0 , \cf6 "AttributeType"\cf0 : \cf6 "S"\cf0 \}],
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 BillingMode=\cf6 "PAY_PER_REQUEST"\cf0 ,
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 )
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Mise en attente durant la cr\'e9ation de la table.
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
table.wait_until_exists()
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Affichage du nombre d'\'e9l\'e9ments de la table apr\'e8s sa cr\'e9ation.
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
print(table.item_count)
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\'a0\
Le code du chatbot ci-dessous impl\'e9mente les composant initiaux de notre application.\
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Import des biblioth\'e8ques Streamlit, Langchain et de la fonction pr\'e9c\'e9dente
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
import\cf0  streamlit \cf2 as\cf0  st
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
from\cf0  langchain.llms \cf2 import\cf0  Bedrock
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
from\cf0  langchain.memory.chat_message_histories \cf2 import\cf0  DynamoDBChatMessageHistory
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
from\cf0  langchain.chains \cf2 import\cf0  ConversationChain
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
from\cf0  langchain.memory \cf2 import\cf0  ConversationBufferMemory
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
from\cf0  langchain.prompts.prompt \cf2 import\cf0  PromptTemplate
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
from\cf0  langchain.memory.chat_message_histories \cf2 import\cf0  StreamlitChatMessageHistory
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
import\cf0  uuid
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# D\'e9finition du prompte par d\'e9faut pour l'initialisation du chatbot
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
DEFAULT_CLAUDE_TEMPLATE = \cf6 """The following is a friendly conversation between a
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf6 \cb3 \expnd0\expndtw0\kerning0
human and an AI. The AI is talkative and provides lots of specific details from its
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf6 \cb3 \expnd0\expndtw0\kerning0
context. If the AI does not know the answer to a question, it truthfully says it
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf6 \cb3 \expnd0\expndtw0\kerning0
does not know.
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf6 \cb3 \expnd0\expndtw0\kerning0
Current conversation:
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf6 \cb3 \expnd0\expndtw0\kerning0
\{history\}
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf6 \cb3 \expnd0\expndtw0\kerning0
Human: \{input\}
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf6 \cb3 \expnd0\expndtw0\kerning0
Assistant:"""
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# D\'e9finition de la structure du prompte (\'e9tape 3 du diagramme d'architecture figure 1)
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
CLAUDE_PROMPT = PromptTemplate(
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 input_variables=[\cf6 "history"\cf0 , \cf6 "input"\cf0 ],\'a0 template=DEFAULT_CLAUDE_TEMPLATE)
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Message d'initiation de la discussion avec le chatbot
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
INIT_MESSAGE = \{\cf6 "role"\cf0 : \cf6 "assistant"\cf0 , \cf6 "content"\cf0 : \cf6 "Comment puis-je vous aider ? "\cf0 \}
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Composants de l'interface graphique
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
st.set_page_config(page_title=\cf6 'Chatbot'\cf0 , layout=\cf6 'wide'\cf0 )
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
st.title(\cf6 "Bonjour, je suis votre chatbot."\cf0 )
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\sa320\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Fonction r\'e9cup\'e9ration d'un identifiant pour la session de discussion pour cr\'e9er un enregistrement sur la base de donn\'e9es DynamoDB
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
@st.cache_data
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
def\cf0  id_sess():
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 id = str(uuid.uuid4())
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 \cf2 return\cf0  id
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
session_id=id_sess()
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Fonction de cr\'e9ation de la chaine de conversation Langchain
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
def\cf0  init_conversationchain():
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 \cf5 # D\'e9finition du mod\'e8le appel\'e9 via l'API Bedrock et de ses param\'e8tres par d\'e9faut
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 model_kwargs = \{\cf6 'temperature'\cf0 : \cf7 0.5\cf0 ,
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0 \cf6 'top_p'\cf0 : \cf7 1\cf0 ,
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0 \cf6 'top_k'\cf0 : \cf7 250\cf0 ,
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0 \cf6 'max_tokens_to_sample'\cf0 : \cf7 500
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0 \}
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 llm = Bedrock( model_id=\cf6 "anthropic.claude-v2:1"\cf0 , model_kwargs=model_kwargs )
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 \cf5 # D\'e9finition de la base de donn\'e9es DynamoDB cr\'e9\'e9e pr\'e9c\'e9demment comme m\'e9moire pour l'historique de conversation
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 message_history = DynamoDBChatMessageHistory(
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0 table_name=\cf6 "SessionTable"\cf0 , session_id=session_id
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 )
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 \cf5 # Cr\'e9ation de la chaine de conversation
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 conversation = ConversationChain(
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0 llm=llm,
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0 verbose=\cf2 True\cf0 ,
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0 memory=ConversationBufferMemory(
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0 ai_prefix=\cf6 "Assistant"\cf0 , chat_memory=message_history,
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0 return_messages=\cf2 True\cf0 ),
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0 prompt=CLAUDE_PROMPT
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 )
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 \cf5 # Initialisation du chatbot avec l'INIT_MESSAGE
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 \cf2 if\cf0  \cf6 "messages"\cf0  \cf2 not\cf0  \cf2 in\cf0  st.session_state.keys():
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0 st.session_state.messages = [INIT_MESSAGE]
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 \cf2 return\cf0  conversation
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Fonction utilis\'e9e pour g\'e9n\'e9rer les r\'e9ponses du chatbot
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
def\cf0  generate_response(conversation, input_text):
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 \cf2 return\cf0  conversation.run(input=input_text)
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Fonction d'initialisation d'un nouveau chat
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
def\cf0  new_chat(session_id):
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 st.session_state[\cf6 "messages"\cf0 ] = [INIT_MESSAGE]
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 st.session_state[\cf6 "langchain_messages"\cf0 ] = []
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 conv_chain = init_conversationchain()
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Ajout d'un bouton \'e0 l'interface graphique pour faire appel \'e0 la fonction de r\'e9initialisation du chat
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
st.sidebar.button(\cf6 "New Chat"\cf0 , on_click=new_chat(session_id), type=\cf6 'primary'\cf0 )
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Initialisation du chatbot
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
conv_chain = init_conversationchain()
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Affichage des messages de la discussion sur l'interface graphique
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
for\cf0  message \cf2 in\cf0  st.session_state.messages:
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 \cf2 with\cf0  st.chat_message(message[\cf6 "role"\cf0 ]):
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0 st.markdown(message[\cf6 "content"\cf0 ])
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# Prompte entr\'e9 par l'utilisateur du chatbot
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb3 \expnd0\expndtw0\kerning0
prompt = st.chat_input()
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
if\cf0  prompt:
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 st.session_state.messages.append(\{\cf6 "role"\cf0 : \cf6 "user"\cf0 , \cf6 "content"\cf0 : prompt\})
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 \cf2 with\cf0  st.chat_message(\cf6 "user"\cf0 ):
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0 st.markdown(prompt)
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf5 \cb3 \expnd0\expndtw0\kerning0
# G\'e9n\'e9rer une r\'e9ponse si le dernier message ne provient pas du chatbot
\f1\fs29\fsmilli14667 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
if\cf0  st.session_state.messages[-\cf7 1\cf0 ][\cf6 "role"\cf0 ] != \cf6 "assistant"\cf0 :
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 \cf2 with\cf0  st.chat_message(\cf6 "assistant"\cf0 ):
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0 \cf2 with\cf0  st.spinner(\cf6 "Thinking..."\cf0 ):
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0 response = generate_response(conv_chain, prompt)
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0\'a0 st.markdown(response)
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 message = \{\cf6 "role"\cf0 : \cf6 "assistant"\cf0 , \cf6 "content"\cf0 : response\}
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \

\f0\fs24 \cb3 \expnd0\expndtw0\kerning0
\'a0\'a0\'a0 st.session_state.messages.append(message)
\f1\fs29\fsmilli14667 \cb1 \kerning1\expnd0\expndtw0 \
}